<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>All Users</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #2196f3;
      --primary-dark: #1769aa;
      --secondary: #74ebd5;
      --accent: #ACB6E5;
      --surface: #fff;
      --text: #222;
      --shadow: 0 8px 36px rgba(33, 150, 243, 0.13), 0 4px 16px rgba(0,0,0,0.11);
      --bg-gradient: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
      --table-row-bg: #f3f7fb;
      --table-row-hover: #e6f2ff;
      --table-text: #222;
      --table-border: #e3e8ee;
    }
    [data-theme="dark"] {
      --surface: #191c20;
      --text: #e8eaf6;
      --bg-gradient: linear-gradient(135deg, #232946 0%, #2b3a67 100%);
      --shadow: 0 8px 36px rgba(37, 60, 89, 0.24), 0 4px 16px rgba(0,0,0,0.28);
      --table-row-bg: #23253a;
      --table-row-hover: #282b45;
      --table-text: #e8eaf6;
      --table-border: #2b3a67;
    }
    html, body {
      font-family: 'Inter', Arial, sans-serif;
      background: var(--bg-gradient);
      min-height: 100vh;
      margin: 0;
      padding: 0;
      color: var(--text);
      transition: background 0.4s;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 2rem 0;
      min-height: 100vh;
    }
    .theme-toggle-sideways {
      position: fixed;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 48px;
      height: 48px;
      background: var(--surface);
      border-radius: 0 20px 20px 0;
      box-shadow: 2px 4px 18px rgba(33,150,243,0.12);
      transition: background 0.3s, color 0.3s;
      border: none;
      cursor: pointer;
      font-size: 1.7rem;
      color: var(--primary-dark);
      outline: none;
      border-right: 2px solid var(--primary);
    }
    .theme-toggle-sideways:focus { color: #ffda47; background: var(--accent);}
    .container {
      background: var(--surface);
      max-width: 1000px;
      width: 98vw;
      margin: 0 auto;
      padding: 2.3rem 1.7rem 2.2rem 1.7rem;
      border-radius: 18px;
      box-shadow: var(--shadow);
      transition: box-shadow 0.3s cubic-bezier(.25,.8,.25,1), background 0.4s;
      position: relative;
      z-index: 2;
      animation: fadein 0.7s;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    @keyframes fadein {
      0% { opacity: 0; transform: scale(0.98);}
      100% { opacity: 1; transform: scale(1);}
    }
    h2 {
      text-align: center;
      margin-bottom: 1.5rem;
      color: var(--primary-dark);
      user-select: none;
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 0.01em;
    }
    /* Search box */
    #searchInput {
      width: 100%;
      max-width: 350px;
      padding: 0.65rem 1rem;
      font-size: 1.09rem;
      border-radius: 9px;
      border: 2px solid var(--primary);
      margin-bottom: 1.2rem;
      box-sizing: border-box;
      transition: border-color 0.3s, box-shadow 0.3s;
      background: #f8fbff;
      color: var(--text);
      outline: none;
      font-family: inherit;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    #searchInput:focus {
      border-color: var(--primary-dark);
      box-shadow: 0 0 8px var(--primary-dark, #1976d2)33;
    }
    /* Table styles */
    .table-wrapper {
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid var(--table-border);
      box-shadow: 0 1.5px 7px #f5faff;
      background: var(--surface);
      min-width: 320px;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 650px;
      user-select: none;
      background: transparent;
      font-size: 1.01rem;
      transition: transform 0.2s ease;
    }
    th, td {
      padding: 14px 18px;
      border-bottom: 1px solid var(--table-border);
      text-align: left;
      transition: background-color 0.2s ease;
      color: var(--table-text);
      background: var(--surface);
    }
    th {
      background-color: var(--primary-dark);
      color: white;
      position: relative;
      user-select: none;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 0.02em;
      font-size: 1.04rem;
    }
    th.sort-asc::after,
    th.sort-desc::after {
      content: '';
      position: absolute;
      right: 12px;
      top: 50%;
      width: 0;
      height: 0;
      border-style: solid;
      transform: translateY(-50%);
    }
    th.sort-asc::after {
      border-width: 0 6px 6px 6px;
      border-color: transparent transparent white transparent;
    }
    th.sort-desc::after {
      border-width: 6px 6px 0 6px;
      border-color: white transparent transparent transparent;
    }
    tbody tr:hover {
      background-color: var(--table-row-hover);
      cursor: pointer;
      transition: background 0.16s;
    }
    tbody tr:nth-child(even) {
      background-color: var(--table-row-bg);
    }
    tbody tr.no-users {
      background: none !important;
      color: var(--table-text) !important;
    }
    /* Responsive */
    @media (max-width: 900px) {
      .container { padding: 1.1rem 0.6rem 1.1rem 0.6rem;}
      h2 { font-size: 1.3rem; }
      .table-wrapper { min-width: 0; }
      table { font-size: 0.98rem; min-width: 360px;}
      th, td { padding: 10px 6px; }
      #searchInput { font-size: 1rem; max-width: 98vw;}
    }
    @media (max-width: 700px) {
      .theme-toggle-sideways {
        top: unset;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        border-right: none;
        border-bottom: 2px solid var(--primary);
      }
    }
    @media (max-width: 500px) {
      h2 { font-size: 1.12rem;}
      th, td { font-size: 0.93rem; }
      .container { padding: 0.4rem 0.1rem 0.7rem 0.1rem;}
    }
  </style>
</head>
<body>
  <button class="theme-toggle-sideways" id="themeToggle" aria-label="Toggle theme" title="Toggle light/dark mode">ðŸŒ™</button>
  <div class="container">
    <h2>All Registered Users</h2>
    <input
      type="text"
      id="searchInput"
      placeholder="Search users by ID, Name, Email, or Role..."
      aria-label="Search users"
    />
    <div class="table-wrapper">
      <table id="userTable" aria-describedby="userTableDesc">
        <thead>
          <tr>
            <th data-column="id" scope="col">ID</th>
            <th data-column="name" scope="col">Name</th>
            <th data-column="email" scope="col">Email</th>
            <th data-column="role" scope="col">Role</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // --- THEME TOGGLE LOGIC ---
    const themeToggle = document.getElementById('themeToggle');
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      themeToggle.textContent = theme === "dark" ? "ðŸŒž" : "ðŸŒ™";
      localStorage.setItem('theme', theme);
    }
    themeToggle.onclick = () => {
      const curr = document.documentElement.getAttribute('data-theme');
      setTheme(curr === "dark" ? "light" : "dark");
    };
    (() => {
      let theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? "dark" : "light");
      setTheme(theme);
    })();

    // --- USERS TABLE LOGIC ---
    const userTableBody = document.querySelector("#userTable tbody");
    const searchInput = document.getElementById("searchInput");
    let usersData = [];
    let currentSort = { column: null, direction: 1 };

    // Fetch users
    fetch("http://localhost:8000/users/")
      .then((res) => res.json())
      .then((data) => {
        usersData = data;
        renderTable(usersData);
      })
      .catch((err) => {
        userTableBody.innerHTML = `<tr class="no-users"><td colspan="4" style="text-align:center; color:#ff5252;">Failed to load users data.</td></tr>`;
        console.error("Fetch error:", err);
      });

    // Render table rows
    function renderTable(data) {
      userTableBody.innerHTML = "";
      if (data.length === 0) {
        userTableBody.innerHTML =
          `<tr class="no-users"><td colspan="4" style="text-align:center; color:#999;">No users found</td></tr>`;
        return;
      }
      data.forEach((user) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${user.id}</td>
          <td>${escapeHtml(user.name)}</td>
          <td>${escapeHtml(user.email)}</td>
          <td>${escapeHtml(user.role)}</td>
        `;
        userTableBody.appendChild(row);
      });
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement("div");
      div.textContent = text;
      return div.innerHTML;
    }

    // Search filter
    searchInput.addEventListener("input", () => {
      const searchTerm = searchInput.value.trim().toLowerCase();
      const filtered = usersData.filter((user) => {
        return (
          user.id.toString().includes(searchTerm) ||
          user.name.toLowerCase().includes(searchTerm) ||
          user.email.toLowerCase().includes(searchTerm) ||
          user.role.toLowerCase().includes(searchTerm)
        );
      });
      renderTable(filtered);
    });

    // Sorting logic
    const headers = document.querySelectorAll("#userTable th");
    headers.forEach((header) => {
      header.addEventListener("click", () => {
        const column = header.getAttribute("data-column");
        if (!column) return;

        // Determine sort direction
        if (currentSort.column === column) {
          currentSort.direction = -currentSort.direction; // toggle direction
        } else {
          currentSort.column = column;
          currentSort.direction = 1;
        }

        // Sort usersData copy for rendering
        const sortedData = [...usersData].sort((a, b) => {
          let valA = a[column];
          let valB = b[column];

          // Numeric sort for ID, string for others
          if (column === "id") {
            valA = Number(valA);
            valB = Number(valB);
          } else {
            valA = valA.toString().toLowerCase();
            valB = valB.toString().toLowerCase();
          }

          if (valA < valB) return -1 * currentSort.direction;
          if (valA > valB) return 1 * currentSort.direction;
          return 0;
        });

        // Clear existing sort indicators
        headers.forEach((h) => h.classList.remove("sort-asc", "sort-desc"));
        header.classList.add(currentSort.direction === 1 ? "sort-asc" : "sort-desc");

        renderTable(sortedData);
      });
    });
  </script>
</body>
</html>